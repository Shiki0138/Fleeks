# ヒートマップ機能 設定・使用ガイド

## 概要
このサイトには包括的なヒートマップ機能が実装されています。Microsoft Clarityを使用して、ユーザーの行動を詳細に追跡・分析できます。

## 実装済み機能

### 1. 基本ヒートマップ機能
- **クリックヒートマップ**: ユーザーがクリックした場所を視覚化
- **スクロールヒートマップ**: ページのどこまでスクロールされたかを表示
- **マウス移動追跡**: マウスの動きを記録

### 2. カスタムイベント追跡
- **CTAボタンクリック**: 全てのCTAボタンのクリックを追跡
- **フォーム操作**: フォーム入力の開始・完了を記録
- **スクロール深度**: 25%, 50%, 75%, 100%のマイルストーンを記録
- **滞在時間**: 30秒、1分、2分、5分の滞在時間を追跡
- **セクション表示**: 重要なセクションがビューポートに入った時を記録

### 3. 対象ページ
- ✅ メインランディングページ (`index.html`)
- ✅ コンサルティングページ (`pages/consulting.html`)
- ✅ セルフサービスページ (`pages/self.html`)
- ✅ 特定商取引法ページ (`pages/tokusho.html`)
- ✅ プライバシーポリシーページ (`pages/privacypolicy.html`)

## Microsoft Clarityダッシュボードの使用方法

### 1. アクセス方法
1. [Microsoft Clarity](https://clarity.microsoft.com/) にアクセス
2. プロジェクトID: `r97sljvec6` でログイン
3. ダッシュボードから分析データを確認

### 2. 主要な分析項目

#### ヒートマップ分析
- **クリックマップ**: どのボタンやリンクが最もクリックされているか
- **スクロールマップ**: ユーザーがページのどこまで読んでいるか
- **エリアマップ**: ページの各エリアへの関心度

#### セッション録画
- 実際のユーザー操作を動画で確認
- 問題のあるユーザー体験を特定
- コンバージョンに至らなかった理由を分析

#### カスタムイベント分析
以下のイベントが自動で記録されています：

```javascript
// CTAボタンクリック
{
  event: 'cta_click',
  button_position: 1,
  button_text: '今すぐエントリーする',
  section: 'hero',
  page_type: 'landing_page'
}

// スクロール深度
{
  event: 'scroll_depth',
  percent: 50,
  page_type: 'landing_page'
}

// フォーム操作
{
  event: 'form_field_focus',
  field_name: 'email',
  field_type: 'email',
  page_type: 'landing_page'
}
```

## 分析のポイント

### 1. コンバージョン最適化
- **CTAボタンの効果測定**: どのCTAが最も効果的か
- **フォーム離脱ポイント**: どの入力項目で離脱が多いか
- **スクロール率**: 重要なコンテンツまで到達しているか

### 2. ユーザビリティ改善
- **クリック集中エリア**: 期待通りの場所がクリックされているか
- **スクロール行動**: コンテンツの長さは適切か
- **モバイル vs デスクトップ**: デバイス別の行動差異

### 3. コンテンツ最適化
- **セクション別エンゲージメント**: どのセクションが最も見られているか
- **滞在時間**: コンテンツの質は十分か
- **離脱ポイント**: どこでユーザーが離脱しているか

## 追加設定オプション

### 1. 新しいイベントの追加
`heatmap-tracker.js`に以下のような形でイベントを追加できます：

```javascript
// 例: 動画再生イベント
document.querySelectorAll('video').forEach(video => {
    video.addEventListener('play', function() {
        clarity('event', 'video_play', {
            video_id: this.id || 'unnamed',
            page_type: getPageType()
        });
    });
});
```

### 2. ページタイプの追加
新しいページを追加する場合は、`getPageType()`関数を更新：

```javascript
function getPageType() {
    const path = window.location.pathname;
    if (path.includes('new-page')) return 'new_page_type';
    // 既存のコード...
}
```

### 3. セグメント分析の設定
ユーザーセグメントを追加する場合：

```javascript
// 例: 参照元による分類
const referrer = document.referrer;
let userSegment = 'direct';
if (referrer.includes('google')) userSegment = 'google';
if (referrer.includes('facebook')) userSegment = 'facebook';

clarity('set', 'traffic_source', userSegment);
```

## トラブルシューティング

### 1. データが表示されない場合
- ブラウザの開発者ツールでJavaScriptエラーを確認
- Microsoft ClarityのプロジェクトIDが正しいか確認
- 24時間以内のデータは反映に時間がかかる場合があります

### 2. イベントが記録されない場合
- `clarity`関数が正しく読み込まれているか確認
- カスタムイベントの名前に特殊文字が含まれていないか確認
- ブラウザのコンソールでエラーメッセージを確認

### 3. パフォーマンスへの影響
- ヒートマップ機能は軽量ですが、大量のイベントは避ける
- 必要に応じてイベントの頻度を調整
- 重要でないイベントは削除を検討

## データプライバシー

### GDPR/個人情報保護法対応
- Microsoft Clarityは個人を特定できる情報は収集しません
- IPアドレスは匿名化されて処理されます
- 必要に応じてプライバシーポリシーに記載を追加

### データ保持期間
- Microsoft Clarityのデータ保持期間: 最大13ヶ月
- 必要に応じて短縮設定が可能

## 推奨分析フロー

### 週次分析
1. **全体的なトラフィック動向**を確認
2. **主要CTAのクリック率**をチェック
3. **新規 vs リピーター**の行動差異を分析

### 月次分析
1. **ヒートマップの変化**を前月と比較
2. **コンバージョンファネル**の改善点を特定
3. **A/Bテスト**の結果を評価

### 改善アクション例
- クリック率の低いCTAボタンのデザイン変更
- スクロール率の低いセクションのコンテンツ見直し
- フォーム離脱率の高い項目の簡素化

## サポート

### 技術的な質問
- Microsoft Clarity公式ドキュメント: https://docs.microsoft.com/en-us/clarity/
- 実装に関する質問は開発チームまで

### 分析に関する相談
- マーケティングチームと連携して定期的な分析レビューを実施
- 改善提案は具体的なデータに基づいて検討

---

このヒートマップ機能により、ユーザーの行動を詳細に把握し、サイトの継続的な改善が可能になります。定期的な分析と改善サイクルを回すことで、コンバージョン率の向上が期待できます。